class Canvas{constructor(t,i){this.ctx=t.getContext("2d"),this.ca=t,this.spritelist=[],this.game=i}prop(t,i){this.ctx.a=i}img(t,i,s){var e=document.createElement("IMG");e.src=t,e.onload=function(){this.ctx.drawImage(e,i,s)}}imge(t,i,s,e,r){e?this.ctx.drawImage(t,i,s,e,r):this.ctx.drawImage(t,i,s)}dataURL(t,i){return thix.ctx.toDataURL(t,i)}imgo(t,i,s,e){t.onload=function(){c.imge(t,i,s),e()}}ctx(){return this.ctx}fr(t,i,s,e,r){this.ctx.beginPath(),this.ctx.strokeStyle=t,this.ctx.fillRect(i,s,e,r),this.ctx.stroke()}get(t,i){return function(t,i,s){var e=t.getImageData(i,s,1,1).data;return"#"+("000000"+function(t,i,s){if(t>255||i>255||s>255)throw"Invalid color component";return(t<<16|i<<8|s).toString(16)}(e[0],e[1],e[2])).slice(-6)}(this.ctx,t,i)}_8bit(){var t=this.ca,i=this.ctx,s=i.getImageData(0,0,t.width,t.height),e=s.data,r=e.length;i.clearRect(0,0,t.width,t.height);for(var h=0;h<r;h+=1)e[4*h]=e[4*h]-e[4*h]%32,e[4*h+1]=e[4*h+1]-e[4*h+1]%32,e[4*h+2]=e[4*h+2]-e[4*h+2]%32;i.putImageData(s,0,0)}plasma(t){var i=document.createElement("CANVAS"),s=i.getContext("2d"),e=t/100,r=this.ca.width*e,h=this.ca.height*e;s.drawImage(this.ca,0,0,r,h),s.msImageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,s.webkitImageSmoothingEnabled=!1,s.imageSmoothingEnabled=!1,this.ctx.drawImage(i,0,0,r,h,0,0,i.width,i.height)}postprocess(){return new class{constructor(t){this.ca=t.ca}bloom(t,i,s,e){var r=this.ca.getContext("2d"),h=document.createElement("canvas");h.width=this.ca.width/s,h.height=this.ca.height/s,h.getContext("2d").drawImage(this.ca,0,0,h.width,h.height),StackBlur.canvasRGB(h,0,0,h.width,h.height,i),r.globalAlpha=t,r.globalCompositeOperation=e,r.drawImage(h,0,0,this.ca.width,this.ca.height),r.globalAlpha=1,r.globalCompositeOperation="source-over"}lighten(t,i){var s=this.ca.getContext("2d"),e=document.createElement("canvas");e.width=this.ca.width,e.height=this.ca.height,e.getContext("2d").drawImage(this.ca,0,0,e.width,e.height),s.globalAlpha=t,s.globalCompositeOperation=i,s.drawImage(e,0,0,this.ca.width,this.ca.height),s.globalAlpha=1,s.globalCompositeOperation="source-over"}motionblur(t){var i=this.ca.getContext("2d"),s=$("#postprocess")[0].getContext("2d");i.globalAlpha=t,i.drawImage($("#postprocess")[0],0,0),i.globalAlpha=1,s.drawImage(this.ca,0,0)}}(this)}filter(t,i,s){var e=this.ca,r=this.ctx,h=r.getImageData(0,0,e.width,e.height),n=h.data,a=n.length;r.clearRect(0,0,e.width,e.height);for(var o=0;o<a;o+=1)n[4*o]=t(n[4*o]),n[4*o+1]=i(n[4*o+1]),n[4*o+2]=s(n[4*o+2]);r.putImageData(h,0,0)}clear(t){t?(this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ca.width,this.ca.height)):this.ctx.clearRect(0,0,this.ca.width,this.ca.height),this.ctx.imageSmoothingEnabled=!1}gete(){return this.ca}getSprites(){return this.spritelist}scrollTo(t,i,s){this.animspeed&&clearInterval(this.animint),this.scrollingTo||(this.scrollingTo=[0,0],this.oldscrollingTo=this.scrollingTo),this.currentscroll=[this.scrollingTo[0],this.scrollingTo[1]],this.scrollingTo=[t,i],this.animspeed=200;var e=this,r=0;return s?this.animint=setInterval((function(){r++;var t=e.currentscroll[0]+(e.scrollingTo[0]-e.currentscroll[0])*s(r/e.animspeed),i=e.currentscroll[1]+(e.scrollingTo[1]-e.currentscroll[1])*s(r/e.animspeed);e.oldscrollingTo=[t,i],e.spritelist.forEach((function(s){s._InternMove(t,i)})),r==e.animspeed&&clearInterval(e.animint)}),1):this.spritelist.forEach((function(s){s._InternMove(t,i)})),this.oldscrollingTo=this.scrollingTo,this}_RegisterSprite(t){return this.spritelist.push(t)}_DestroySprite(t){return delete this.spritelist[t],this.spritelist=this.spritelist.filter((function(t){return null!=t})),!0}setCamZ(t){return this.spritelist.forEach((function(i){i.zModif=1/t})),this.spritelist=this.spritelist.filter((function(t){return null!=t})),this}}class ParticleSystem{constructor(t,i,s,e,r,h,n){var a=n.width,o=n;o.getContext("2d");this.sprite=t,this.spritelist={},this.r=a,this.col=i,this.count=s,this.speed=e,this.to=r,this.tonull=null==r,this.from=h;var c=this.sprite;t.ccostume("particlesystem",o),t.scostume("particlesystem"),this.texture=o;var l=this;l.deleting=!1,setTimeout((async function(){delete l.spritelist[Object.keys(l.spritelist)[0]]}),1e3/e),this.int=setInterval((function(){var t={x:h[0],y:h[1]},i=[t.x,t.y];l.tonull&&(l.to=[t.x,t.y],r=[t.x,t.y]);var s=(r[0]-h[0])/(c.game.tps/e),n=(r[1]-h[0])/(c.game.tps/e),o=token();l.spritelist[o]=i,l.spritelist[o][2]=-2;var g={};g.angle=Math.floor(360*Math.random());var u=setInterval((function(){if(l.tonull){t=angleMove(0,0,2*e,g.angle+Math.random());i[0]=i[0]+t.x,i[1]=i[1]+t.y}else{l.spritelist[o][2]%10==0&&(g.angle=Math.floor(360*Math.random())),i[0]=i[0]+s,i[1]=i[1]+n;var t=angleMove(0,0,a/2,g.angle);i[0]=i[0]+t.x,i[1]=i[1]+t.y}setTimeout((function(){clearInterval(u),delete l.spritelist[o]}),1e3/e);try{l.spritelist[o][2]++,l.spritelist[o][3]=(1/(e/c.game.tps)-l.spritelist[o][2])/(1/(e/c.game.tps))}catch(t){}}),1e3/c.game.tps)}),1e3/this.count)}destroy(){return clearInterval(this.int),!0}}function token(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890".split(""),i=[],s=0;s<20;s++)i.push(t[Math.floor(Math.random()*t.length)]);return i.join("")}class Sprite{constructor(t,i,s){this.interncoords=[0,0],this.cost={},this.stamps=[],this.ca=t,this.spritelistid=t._RegisterSprite(this,s),this.nsc=!0,this.z=1,this.zModif=1,this.alpha=1,this.scale=[],this.put(0,0),this.game=i,this.inFront=!1,this.ps=null,this.isps=!1,this.isInfinite=!1,this.infiniteSprites=[],this.infiniteSpritesother=[],this.absx=0,this.absy=0}createPhysics(t){return this.physics=t,this}createParticleSystem(t,i,s,e,r,h){var n=new ParticleSystem(this,t,i,s,e,r,h);return this.ps=n,this.isps=!0,this}setInfinite(t){if(this.isInfinite=t,this.infiniteSprites={},this.infiniteSpritesother={},t&&"x"==t){for(var i=null==this.scale[0]?this.img.width:this.scale[0],s=0;s<Math.floor(this.ca.ca.width/i)+3;s++){var e=new Sprite((h=this).ca,h.game).canbeScrolled(!1),r=token();h.infiniteSprites[r]=[e]}for(s=0;s<Math.floor(this.ca.ca.width/i)+3;s++){var h;e=new Sprite((h=this).ca,h.game).canbeScrolled(!1),r=token();h.infiniteSpritesother[r]=[e]}}return this}render(){if(!this.norender&&Object.keys(this.cost).length>0){if(this.ca.ctx.globalAlpha=this.alpha,this.inFront)var t=this.z;else t=this.z*this.zModif;var i=this.img.width,s=this.img.height;if(this.scale.length>0&&(i=this.scale[0],s=this.scale[1]),this.isps){var e=this;Object.keys(this.ps.spritelist).forEach((function(r,h){var n=e.ps.spritelist[r];null!=n&&(e.nsc?e.ca.imge(e.ps.texture,(n[0]+e.interncoords[0]+e.x)*t,(n[1]+e.interncoords[1]+e.y)*t,i*n[3],s*n[3]):e.ca.imge(e.ps.texture,(n[0]+e.x)*t,(n[1]+e.y)*t,i*n[3],s*n[3]))}))}else if(this.nsc?(this.absx=(this.x+this.interncoords[0])*t,this.absy=(this.y+this.interncoords[1])*t,this.ca.imge(this.img,(this.x+this.interncoords[0])*t,(this.y+this.interncoords[1])*t,i,s)):this.ca.imge(this.img,this.x*t,this.y*t,i,s),this.isInfinite){e=this;var r=this;Object.keys(this.infiniteSprites).forEach((function(t,s){Object.keys(e.infiniteSprites).length;var h=t,n=r.absx,a=r.absy,o=e.infiniteSprites[t][0];o.put(n%i+i*(1+Object.keys(r.infiniteSprites).indexOf(h)),a),o.ccostume("main",r.img),o.scostume("main"),e.infiniteSprites[t][0].render()})),Object.keys(this.infiniteSpritesother).forEach((function(t,s){Object.keys(e.infiniteSpritesother).length;var h=t,n=r.absx,a=r.absy,o=e.infiniteSpritesother[t][0];o.put(n%i-i*(Object.keys(r.infiniteSpritesother).indexOf(h)-1),a),o.ccostume("main",r.img),o.scostume("main"),e.infiniteSpritesother[t][0].render()}))}this.ca.ctx.globalAlpha=1}}_InternMove(t,i){return this.interncoords=[t,i],this}move(t,i){return this.put(this.x+t,this.y+i),this}put(t,i){return this.isps?(this.ps.from[0]=t,this.ps.from[1]=i):(this.x=t,this.y=i),this.norender=null==t,this}getpos(){var t={};return this.isps?(t.x=this.ps.from[0],t.y=this.ps.from[1]):(t.x=this.x,t.y=this.y),t}get(){return this}ccostume(t,i){return this.cost[t]=i,this}scostume(t){return this.img=this.cost[t],this}stamp(){return this.render(),this}canbeScrolled(t){return this.nsc=t,this}setZ(t){return this.z=t,this}isInFront(t){return this.inFront=t,this}setAlpha(t){return this.alpha=t,this}setScale(t){return this.scale=t,this}destroy(){return this.ca._DestroySprite(this.spritelistid),!0}}function angleMove(t,i,s,e){return e=e/180*Math.PI,{x:t+s*Math.cos(e),y:i+s*Math.sin(e)}}function toImg(t){return new Promise((i=>{var s=new Image;s.src=t,s.onload=function(){i(s)}}))}EasingFunctions={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};class Game{constructor(t){this.tps=t,this.gameloops=[],this.ticks=0;var i=this;this.interval=setInterval((function(){i.ticks++}),1e3/this.tps)}setup(t){return this.setupfunc=t,t(),this}gameloop(t){t.setinterval(i,this);var i=this.gameloops.push(t);return i}async destroy(){return clearInterval(this.interval),this.gameloops.forEach((function(t){t.destroy()})),this.gameloops=[],!0}}class GameLoop{constructor(t){this.func=t,this.active=!0}setActive(t){return this.active=t,this}setinterval(t,i){var s=this;return this.int=setInterval((function(){s.func(s.game.ticks)}),1e3/i.tps),this.id=t,this.game=i,this}destroy(){return clearInterval(this.int),delete this.game.gameloops[this.id],this.game.gameloops=this.game.gameloops.filter((function(t){return null!=t})),!0}}class SpriteSheet{constructor(t,i,s){return this.img=t,this.spw=i,this.sph=s,this.row=t.width/i,this.col=t.height/s,this}get(t){var i=document.createElement("CANVAS");i.width=this.spw,i.height=this.sph;var s=i.getContext("2d"),e=t%this.row,r=Math.floor(t/this.row);return s.drawImage(this.img,e*this.spw,r*this.sph,this.img.width,this.img.height,0,0,this.img.width,this.img.height),i}}class Physics{constructor(t){this.sprite=t,t.createPhysics(this),this.vx=0,this.vy=0;var i=this;this.interval=setInterval((function(){var t=i.sprite.getpos();i.sprite.put(t.x+i.vx,t.y+i.vy),i.vx=i.vx-i.vx/2,t.y>140&&i.vy>0?(t.y,i.vy=0):t.y>145||(i.vy=i.vy+.4)}),1e3/i.sprite.game.tps)}}